# ARP 프로토콜, Address Resolution Protocol

- IP 주소를 이용해 MAC 주소를 알아내는 프로토콜
- L2 구간에서는 MAC 주소로 라우팅하므로, 요청을 보낼 때 목적지 IP와 함께 **MAC 주소**를 함께 보내야 한다.
- L2 스위치로 연결된 **LAN**에서 통신할 때는 목적지 IP 주소를 보고 해당 목적지 호스트의 MAC 주소도 보내야 한다. → LAN의 정의를 ARP 응답이 미치는 범위라고 정의하기도 함
- 이를 위해 IP 주소와 MAC 주소를 일대일로 대응하여 테이블로 정리한다. 엔드 포인트와 스위치 모두 **ARP Table**을 관리하며, 스위치는 각 포트에 연결된 주소들을 기억한다.

# ARP Table

L2 스위치의 ARP Table

- 스위치는 학습모드에서 각 포트에서 올라오는 호스트의 MAC 주소를 기록한다.
- 각 포트마다 여러개의 MAC 주소를 기록하는데, L2 Distribution 스위치라면 업링크로 올라오는 호스트가 여러개일 수 있기 때문이다.

엔드 포인트의 ARP Table

- 목적지 IP에 대응되는 호스트의 MAC 주소를 기록한다.
- 만약 ARP Table에 목적지 IP가 기록되지 않았다면, 브로드캐스트를 통해 해당 IP 주소를 가진 호스트의 MAC 주소를 알아내어 기록한다.
- 해당 호스트에서 목적지 IP로 패킷을 전송할 때, ARP Table에서 이 IP에 매핑된 MAC 주소를 찾아 L2 헤더를 구성한다.

# ARP 작동 방식

- LAN의 엔드 포인트에서 인터넷을 통해 서버에 트래픽을 보내려면, L2 Frame을 Gateway에 보내야 한다.
- 전원을 막 켠 엔드 포인트는 자신의 게이트웨이로 설정된 IP 주소의 MAC 주소를 알 수 없다. 이 MAC 주소를 알아내기 위해 LAN에 ARP request를 브로드캐스트를 한다.
- Gateway는 이 요청에 ARP response를 보내고, 엔드 포인트는 응답으로 받은 MAC 주소를 ARP Table에 캐시한다.